{% extends '::layout.html.twig' %}

{% block title %}La deMOIs’aile - Écoles participantes{% endblock %}
{% block metaDescription %}La deMOIs’aile : Liste des écoles participantes au site La deMOIs’aile{% endblock %} 


{% block content %}
<style>
    .navbar::after {
        display: none !important;
    }
</style>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAnpSNx1aJYFqIH13K16S1R1gGI22ZMFBw" type="text/javascript"></script>

<main id="main" class="site-main ecole-participantes">
    <div class="container">
        
        <div class="row">
            
            <div class="col-sm-12">
                
                <div id="primary" class="content-area">
                    <br/><br/>
                    <h1>Écoles participantes</h1>
                    <hr/>
                </div>
            </div>
        </div>
    </div>                

    <div class="row">
        <div class="col-md-5 order-2 order-lg-1">
            <div class="left_ec">
                {% for ecole in ecoles %}
                  <div class="bloc_ecole {{ ecole.slug }}">
                       <a href="{{ path('site_ecole_single', {'slug': ecole.slug}) }}">
                            <img alt="Logo {{ ecole.nom }}" src="{{ asset('uploads/logos-ecoles/') }}{{ ecole.logo.id}}.{{ ecole.logo.url}}">
                            <div class="be_text">
                                <h4>{{ ecole.nom }}</h4>
                                <p>{{ ecole.region.nom }}</p>
                            </div>    
                        </a>
                   </div>
                {% endfor %}
            </div>
        </div>   
        <div class="col-md-7 order-1 order-lg-2"> 
            <div id="map" class="map_ecole"></div>
            
        </div>
    </div><!-- row -->
    <div class="inscri_bas">                            
        <h4>Ton école ne s'y retrouve pas ?</h4>
        <br/>
        <a href="{{ path('viweb_soumission_new') }}" class="btn btn-primary">J'inscris mon école</a>
    </div>


</main><!-- #main -->

 <script type='text/javascript'>
 jQuery( document ).ready(function($) {
    function initMap(lati, long) {
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 7,
        center: { lat: lati, lng: long },
      });

      setMarkers(map);
    }

    const ecoles = [
        {% set lati = 0 %}
        {% set long = 0 %}

        {% for ecole in ecoles %}
            ["{{ ecole.nom }}", {{ ecole.latitude }}, {{ ecole.longitude }}, 4,"<div class='infopop {{ ecole.slug }}'><img alt='' src='{{ absolute_url(asset('/uploads/logos-ecoles/')) }}{{ ecole.logo.id }}.{{ ecole.logo.url }}'><div class='text_infpop'><h4>{{ ecole.nom }}</h4><div></div>{{ ecole.adresse }},<br>{{ ecole.ville }}<br>{{ ecole.codepostal }}<br>Téléphone : {{ ecole.telephone }}<br/><br/><a href='{{ path('site_ecole_single', {'slug': ecole.slug}) }}'>Voir l'école</a></div></div>"],
        {% endfor %}
    ];
    //var lati = {{ lati / ecoles|length }}
    //var long = {{ long / ecoles|length }}
    function setMarkers(map) {

      const image = {
        url: "/web/assets/scss/images/ladem.png",
        size: new google.maps.Size(32, 31),
        
        origin: new google.maps.Point(0, 0),
        
        anchor: new google.maps.Point(0, 0),
      };

      const shape = {
        coords: [1, 1, 1, 20, 18, 20, 18, 1],
        type: "poly",
      };

      for (let i = 0; i < ecoles.length; i++) {
        const ecole = ecoles[i];

        marker = new google.maps.Marker({
          position: { lat: ecole[1], lng: ecole[2] },
          map,
          icon: image,
          shape: shape,
          title: ecole[0],
          zIndex: ecole[3],
        });
        addInfoWindow(marker, ecole[4])
      }
    }

    function addInfoWindow(marker, message) {

        var infoWindow = new google.maps.InfoWindow({
            content: message
        });

        google.maps.event.addListener(marker, 'click', function () {
            infoWindow.open(map, marker);
        });
    }

    initMap(46.39437774351471, -77.02748333581863);
});    
</script>   

{% endblock %}

